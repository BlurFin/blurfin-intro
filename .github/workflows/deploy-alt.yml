name: Deploy to Production (Alternative)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Deployment environment"
        required: true
        default: "production"
        type: choice
        options:
          - production

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Debug SSH Connection
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: 22
          timeout: 60s
          command_timeout: 10m
          debug: true
          script: |
            echo "ğŸ” SSH Connection Test"
            whoami
            pwd
            date
            uptime

      - name: ğŸš€ Deploy to Server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.SSH_KEY }}
          port: 22
          timeout: 60s
          command_timeout: 10m
          script: |
            cd ~/blurfin-intro

            echo "ğŸ“¥ Pulling latest changes from main branch..."
            git fetch origin
            git reset --hard origin/main

            echo "ğŸ“¦ Installing dependencies..."
            npm ci --production

            echo "ğŸ”¨ Building project..."
            npm run build

            echo "ğŸ”„ Restarting PM2 process..."
            pm2 restart blurfin-server

            echo "âœ… Deployment completed successfully!"
            pm2 status

            echo "ğŸŒ Site is now live at https://blurfin.com"
